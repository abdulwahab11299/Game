<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Galaxy Shooter</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
      font-family: sans-serif;
    }
    canvas {
      display: block;
      background: #000;
      border: 2px solid white;
      margin: 0 auto;
      touch-action: none;
    }
    #hud {
      color: white;
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 16px;
      z-index: 1;
    }
    #pauseBtn {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 10px 20px;
      background: #333;
      color: white;
      border: 2px solid white;
      cursor: pointer;
      font-size: 16px;
      z-index: 1;
    }
    #pauseBtn:hover {
      background: #555;
    }
    .glow {
      filter: drop-shadow(0 0 5px rgba(255, 0, 0, 0.8));
    }
    #bossHealthBar {
      position: absolute;
      top: 50px;
      left: 10px;
      width: 200px;
      height: 20px;
      background: red;
      border: 2px solid white;
      z-index: 1;
      display: none;
    }
    #bossHealthFill {
      height: 100%;
      background: lime;
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="hud">Score: 0 | Level: 1 | Health: 3</div>
  <button id="pauseBtn">Pause</button>
  <div id="bossHealthBar"><div id="bossHealthFill"></div></div>
  <canvas id="gameCanvas"></canvas>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const hud = document.getElementById("hud");
    const pauseBtn = document.getElementById("pauseBtn");
    const bossHealthBar = document.getElementById("bossHealthBar");
    const bossHealthFill = document.getElementById("bossHealthFill");

    // Canvas size
    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resize);
    resize();

    // Game state
    let score = 0,
        level = 1,
        playerHealth = 3;
    let bullets = [],
        enemies = [],
        powerUps = [],
        healthPowerUps = [],
        bossBullets = [];
    let isFiring = false,
        touchStartX = 0;
    let activePowerUp = null,
        powerUpTimer = 0;
    let gameActive = true;
    let isPaused = false;
    let damageFlash = 0;
    let firingInterval = null;
    let boss = null;
    let isBossActive = false;
    let bossSpawnedThisLevel = false;

    // Sound effects
    const sounds = {
      shoot: new Audio('https://www.soundjay.com/buttons/sounds/button-1.mp3'),
      hit: new Audio('https://www.soundjay.com/mechanical/sounds/explosion-01.mp3'),
      powerUp: new Audio('https://www.soundjay.com/misc/sounds/power-up-01.mp3'),
      health: new Audio('https://www.soundjay.com/misc/sounds/magic-spell-01.mp3'),
      gameOver: new Audio('https://www.soundjay.com/misc/sounds/game-over-01.mp3'),
      bossHit: new Audio('https://www.soundjay.com/mechanical/sounds/explosion-01.mp3')
    };

    // Starfield
    let stars = [];
    for (let i = 0; i < 100; i++) {
      stars.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        speed: Math.random() * 2 + 1,
      });
    }

    const spaceship = {
      width: 50,
      height: 50,
      x: canvas.width / 2 - 25,
      y: canvas.height - 80,
      speed: 7,
    };

    // Boss definition
    const bossTemplate = {
      x: canvas.width / 2 - 50,
      y: 50,
      width: 100,
      height: 100,
      health: 100,
      maxHealth: 100,
      speed: 3,
      direction: 1,
      shootTimer: 0,
      shootInterval: 1000 // Boss shoots every 1 second
    };

    // Keyboard controls
    let keys = {};
    window.addEventListener("keydown", (e) => {
      keys[e.code] = true;
      if (e.code === "Space" && !isFiring && gameActive && !isPaused) {
        isFiring = true;
        fireBullet();
        firingInterval = setInterval(fireBullet, 200);
      }
      if (e.code === "KeyP") {
        togglePause();
      }
    });
    window.addEventListener("keyup", (e) => {
      keys[e.code] = false;
      if (e.code === "Space") {
        isFiring = false;
        clearFiringInterval();
      }
    });

    function togglePause() {
      isPaused = !isPaused;
      pauseBtn.textContent = isPaused ? "Resume" : "Pause";
      if (isPaused) {
        ctx.fillStyle = "rgba(0, 0, 0, 0.8)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "white";
        ctx.font = "40px Arial";
        ctx.textAlign = "center";
        ctx.fillText("Paused", canvas.width / 2, canvas.height / 2);
      }
    }

    pauseBtn.addEventListener("click", togglePause);

    function handleKeyboard() {
      if (!isPaused && gameActive) {
        if (keys["ArrowLeft"] && spaceship.x > 0) spaceship.x -= spaceship.speed;
        if (keys["ArrowRight"] && spaceship.x + spaceship.width < canvas.width)
          spaceship.x += spaceship.speed;
      }
    }

    // Touch controls
    canvas.addEventListener("touchstart", (e) => {
      if (!gameActive) {
        restartGame();
        return;
      }
      if (isPaused) {
        togglePause();
        return;
      }
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const x = touch.clientX - rect.left;
      const y = touch.clientY - rect.top;
      if (
        x > spaceship.x &&
        x < spaceship.x + spaceship.width &&
        y > spaceship.y &&
        y < spaceship.y + spaceship.height
      ) {
        isFiring = true;
        touchStartX = x - spaceship.x;
        fireBullet();
        firingInterval = setInterval(fireBullet, 200);
      }
    });

    canvas.addEventListener("touchmove", (e) => {
      if (!isPaused) {
        e.preventDefault();
        const touch = e.touches[0];
        const rect = canvas.getBoundingClientRect();
        const x = touch.clientX - rect.left;
        spaceship.x = x - touchStartX;
        if (spaceship.x < 0) spaceship.x = 0;
        if (spaceship.x + spaceship.width > canvas.width)
          spaceship.x = canvas.width - spaceship.width;
      }
    });

    canvas.addEventListener("touchend", () => {
      isFiring = false;
      clearFiringInterval();
    });

    function clearFiringInterval() {
      if (firingInterval) {
        clearInterval(firingInterval);
        firingInterval = null;
      }
    }

    function fireBullet() {
      if (isFiring && gameActive && !isPaused) {
        let bulletSpeed = 10;
        let bulletWidth = 5;
        let bulletHeight = 12;
        let bulletColor = "red";

        if (activePowerUp === "double") {
          bulletSpeed = 12;
          bulletColor = "cyan";
          bullets.push({
            x: spaceship.x + spaceship.width / 2 - 10,
            y: spaceship.y,
            speed: bulletSpeed,
            width: bulletWidth,
            height: bulletHeight,
            color: bulletColor,
          });
          bullets.push({
            x: spaceship.x + spaceship.width / 2 + 5,
            y: spaceship.y,
            speed: bulletSpeed,
            width: bulletWidth,
            height: bulletHeight,
            color: bulletColor,
          });
        } else if (activePowerUp === "triple") {
          bulletSpeed = 14;
          bulletColor = "yellow";
          bulletWidth = 4;
          bullets.push({
            x: spaceship.x + spaceship.width / 2 - 2.5,
            y: spaceship.y,
            speed: bulletSpeed,
            width: bulletWidth,
            height: bulletHeight,
            color: bulletColor,
          });
          bullets.push({
            x: spaceship.x + spaceship.width / 2 - 10,
            y: spaceship.y,
            dir: -1,
            speed: bulletSpeed,
            width: bulletWidth,
            height: bulletHeight,
            color: bulletColor,
          });
          bullets.push({
            x: spaceship.x + spaceship.width / 2 + 5,
            y: spaceship.y,
            dir: 1,
            speed: bulletSpeed,
            width: bulletWidth,
            height: bulletHeight,
            color: bulletColor,
          });
        } else {
          bullets.push({
            x: spaceship.x + spaceship.width / 2 - 2.5,
            y: spaceship.y,
            speed: bulletSpeed,
            width: bulletWidth,
            height: bulletHeight,
            color: bulletColor,
          });
        }
        sounds.shoot.cloneNode(true).play();
      }
    }

    function drawBackground() {
      ctx.fillStyle = "white";
      stars.forEach((star) => {
        star.y += star.speed;
        if (star.y > canvas.height) star.y = 0;
        ctx.fillRect(star.x, star.y, 2, 2);
      });
    }

    function drawSpaceship() {
      ctx.fillStyle = damageFlash > 0 ? "red" : "white";
      ctx.beginPath();
      ctx.moveTo(spaceship.x + spaceship.width / 2, spaceship.y);
      ctx.lineTo(spaceship.x, spaceship.y + spaceship.height);
      ctx.lineTo(spaceship.x + spaceship.width, spaceship.y + spaceship.height);
      ctx.closePath();
      ctx.fill();
      if (damageFlash > 0) damageFlash -= 16;
    }

    function drawBullets() {
      bullets.forEach((b, i) => {
        b.y -= b.speed;
        if (b.dir === 1) b.x += 3;
        else if (b.dir === -1) b.x -= 3;

        ctx.fillStyle = b.color;
        ctx.beginPath();
        ctx.rect(b.x, b.y, b.width, b.height);
        ctx.fill();
        ctx.closePath();

        ctx.fillStyle = `rgba(${
          b.color === "red" ? "255, 0, 0" : b.color === "cyan" ? "0, 255, 255" : "255, 255, 0"
        }, 0.3)`;
        ctx.beginPath();
        ctx.rect(b.x, b.y + b.height, b.width, b.height * 1.5);
        ctx.fill();
        ctx.closePath();

        if (b.y < 0) bullets.splice(i, 1);
      });
    }

    function drawEnemies() {
      enemies.forEach((e, ei) => {
        e.y += 2 + level * 0.2;
        ctx.fillStyle = "lime";
        ctx.fillRect(e.x, e.y, 30, 30);

        bullets.forEach((b, bi) => {
          if (
            b.x < e.x + 30 &&
            b.x + b.width > e.x &&
            b.y < e.y + 30 &&
            b.y + b.height > e.y
          ) {
            enemies.splice(ei, 1);
            bullets.splice(bi, 1);
            score += 10;
            sounds.hit.cloneNode(true).play();
            updateLevel();
          }
        });

        if (
          e.x < spaceship.x + spaceship.width &&
          e.x + 30 > spaceship.x &&
          e.y < spaceship.y + spaceship.height &&
          e.y + 30 > spaceship.y
        ) {
          enemies.splice(ei, 1);
          playerHealth -= 1;
          damageFlash = 200;
          if (playerHealth <= 0) gameOver();
        }
      });
    }

    function drawBoss() {
      if (boss && isBossActive) {
        // Draw boss
        ctx.fillStyle = "purple";
        ctx.fillRect(boss.x, boss.y, boss.width, boss.height);
        ctx.fillStyle = "white";
        ctx.font = "20px Arial";
        ctx.fillText("BOSS", boss.x + boss.width / 2 - 20, boss.y - 10);

        // Update boss health bar
        bossHealthBar.style.display = "block";
        const healthPercentage = (boss.health / boss.maxHealth) * 100;
        bossHealthFill.style.width = `${healthPercentage}%`;

        // Move boss side to side
        boss.x += boss.speed * boss.direction;
        if (boss.x <= 0 || boss.x + boss.width >= canvas.width) {
          boss.direction *= -1;
        }

        // Boss shooting
        boss.shootTimer += 16;
        if (boss.shootTimer >= boss.shootInterval) {
          bossBullets.push({
            x: boss.x + boss.width / 2 - 5,
            y: boss.y + boss.height,
            width: 10,
            height: 15,
            speed: 5,
            color: "orange"
          });
          sounds.shoot.cloneNode(true).play();
          boss.shootTimer = 0;
        }

        // Check for bullet collisions with boss
        bullets.forEach((b, bi) => {
          if (
            b.x < boss.x + boss.width &&
            b.x + b.width > boss.x &&
            b.y < boss.y + boss.height &&
            b.y + b.height > boss.y
          ) {
            boss.health -= 5; // Each bullet deals 5 damage
            bullets.splice(bi, 1);
            sounds.bossHit.cloneNode(true).play();
            if (boss.health <= 0) {
              score += 100; // Bonus points for defeating boss
              boss = null;
              isBossActive = false;
              bossHealthBar.style.display = "none";
              bossSpawnedThisLevel = true; // Prevent boss from respawning in same level
              updateLevel();
            }
          }
        });

        // Check for boss collision with player
        if (
          boss.x < spaceship.x + spaceship.width &&
          boss.x + boss.width > spaceship.x &&
          boss.y < spaceship.y + spaceship.height &&
          boss.y + boss.height > spaceship.y
        ) {
          playerHealth -= 1;
          damageFlash = 200;
          if (playerHealth <= 0) gameOver();
        }
      }
    }

    function drawBossBullets() {
      bossBullets.forEach((b, i) => {
        b.y += b.speed;
        ctx.fillStyle = b.color;
        ctx.beginPath();
        ctx.rect(b.x, b.y, b.width, b.height);
        ctx.fill();
        ctx.closePath();

        // Check for boss bullet collision with player
        if (
          b.x < spaceship.x + spaceship.width &&
          b.x + b.width > spaceship.x &&
          b.y < spaceship.y + spaceship.height &&
          b.y + b.height > spaceship.y
        ) {
          bossBullets.splice(i, 1);
          playerHealth -= 1;
          damageFlash = 200;
          if (playerHealth <= 0) gameOver();
        }

        if (b.y > canvas.height) bossBullets.splice(i, 1);
      });
    }

    function drawPowerUps() {
      powerUps.forEach((p, pi) => {
        p.y += 2;
        ctx.fillStyle = p.type === "double" ? "cyan" : "orange";
        ctx.beginPath();
        ctx.arc(p.x, p.y, 8, 0, Math.PI * 2);
        ctx.fill();

        if (
          p.x > spaceship.x &&
          p.x < spaceship.x + spaceship.width &&
          p.y > spaceship.y &&
          p.y < spaceship.y + spaceship.height
        ) {
          activePowerUp = p.type;
          powerUpTimer = 5000;
          powerUps.splice(pi, 1);
          sounds.powerUp.cloneNode(true).play();
        }
      });

      if (powerUpTimer > 0) {
        powerUpTimer -= 16;
        if (powerUpTimer <= 0) activePowerUp = null;
      }
    }

    function drawHealthPowerUps() {
      ctx.fillStyle = "yellow";
      healthPowerUps.forEach((p, pi) => {
        p.y += 2;
        ctx.beginPath();
        ctx.arc(p.x, p.y, 8, 0, Math.PI * 2);
        ctx.fill();

        if (
          p.x > spaceship.x &&
          p.x < spaceship.x + spaceship.width &&
          p.y > spaceship.y &&
          p.y < spaceship.y + spaceship.height
        ) {
          if (playerHealth < 3) {
            playerHealth += 1;
            sounds.health.cloneNode(true).play();
          }
          healthPowerUps.splice(pi, 1);
        }
      });
    }

    function spawnEnemies() {
      if (!gameActive || isPaused || isBossActive) return;
      if (Math.random() < 0.02 + level * 0.001) {
        enemies.push({ x: Math.random() * (canvas.width - 30), y: 0 });
      }
      if (Math.random() < 0.003) {
        powerUps.push({
          x: Math.random() * canvas.width,
          y: 0,
          type: Math.random() < 0.5 ? "double" : "triple",
        });
      }
      if (Math.random() < 0.002) {
        healthPowerUps.push({ x: Math.random() * canvas.width, y: 0 });
      }
    }

    function spawnBoss() {
      if (level % 10 === 0 && !bossSpawnedThisLevel && !isBossActive && enemies.length === 0) {
        boss = { ...bossTemplate, health: 100 + (level - 10) * 20, maxHealth: 100 + (level - 10) * 20 };
        isBossActive = true;
        bossHealthBar.style.display = "block";
      }
    }

    function updateLevel() {
      if (score >= level * 100) {
        level++;
        bossSpawnedThisLevel = false; // Reset boss spawn flag for new level
      }
      spawnBoss();
    }

    function gameOver() {
      gameActive = false;
      sounds.gameOver.play();
      ctx.fillStyle = "rgba(0, 0, 0, 0.8)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "white";
      ctx.font = "40px Arial";
      ctx.textAlign = "center";
      ctx.fillText("Game Over", canvas.width / 2, canvas.height / 2 - 50);
      ctx.fillText(`Score: ${score}`, canvas.width / 2, canvas.height / 2);
      ctx.font = "20px Arial";
      ctx.fillText("Tap to Restart", canvas.width / 2, canvas.height / 2 + 50);
    }

    function restartGame() {
      score = 0;
      level = 1;
      playerHealth = 3;
      enemies = [];
      bullets = [];
      powerUps = [];
      healthPowerUps = [];
      bossBullets = [];
      activePowerUp = null;
      powerUpTimer = 0;
      damageFlash = 0;
      boss = null;
      isBossActive = false;
      bossSpawnedThisLevel = false;
      bossHealthBar.style.display = "none";
      spaceship.x = canvas.width / 2 - 25;
      isFiring = false;
      isPaused = false;
      pauseBtn.textContent = "Pause";
      clearFiringInterval();
      gameActive = true;
    }

    function gameLoop() {
      if (gameActive && !isPaused) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawBackground();
        drawSpaceship();
        drawBullets();
        drawEnemies();
        drawBoss();
        drawBossBullets();
        drawPowerUps();
        drawHealthPowerUps();
        spawnEnemies();
        handleKeyboard();
        hud.innerText = `Score: ${score} | Level: ${level} | Health: ${playerHealth}`;
      }
      requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
</body>
</html>
